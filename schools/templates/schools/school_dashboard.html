{% extends 'layout.html' %}
{% load static %}

{% block page_title %}{{ school.school_name }} - School Dashboard{% endblock %}

{% block breadcrumb_items %}
    <span class="mx-2 text-gray-400">/</span>
    <a href="{% url 'schools:school_dashboard' %}" class="text-gray-600 hover:text-blue-600 transition">Schools</a>
    <span class="mx-2 text-gray-400">/</span>
    <span class="text-gray-800 font-medium">{{ school.school_name }}</span>
{% endblock %}

{% block content %}
<style>
    .stat-card {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    .stat-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        transform: rotate(45deg);
    }
    .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
    }
    .info-card {
        backdrop-filter: blur(10px);
        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
        border: 1px solid rgba(203, 213, 225, 0.3);
    }
    .action-btn {
        position: relative;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .action-btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }
    .action-btn:hover::after {
        width: 300px;
        height: 300px;
    }
    .hexagon-clip {
        clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-gray-100 to-slate-200 px-4 py-6">
    <div class="max-w-7xl mx-auto">
        
        <!-- Modern School Header -->
        <div class="relative mb-10 overflow-hidden rounded-3xl shadow-2xl" 
             style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="absolute inset-0 opacity-10">
                <div class="absolute inset-0" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.1) 35px, rgba(255,255,255,.1) 70px);"></div>
            </div>
            <div class="relative p-8">
                <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
                    <div class="flex items-start gap-6">
                        {% if school.logo %}
                        <div class="hexagon-clip bg-white p-1 flex-shrink-0">
                            <img src="{{ school.logo.url }}" alt="{{ school.school_name }}" 
                                 class="w-20 h-20 object-contain">
                        </div>
                        {% else %}
                        <div class="hexagon-clip bg-white/20 backdrop-blur-sm p-6 flex-shrink-0 flex items-center justify-center">
                            <i class="fas fa-school text-3xl text-white"></i>
                        </div>
                        {% endif %}
                        <div class="text-white">
                            <h1 class="text-4xl font-black mb-2 tracking-tight">{{ school.school_name }}</h1>
                            {% if school.school_name_arabic %}
                            <p class="text-purple-100 text-lg mb-3" dir="rtl">{{ school.school_name_arabic }}</p>
                            {% endif %}
                            <div class="flex flex-wrap gap-2">
                                <span class="px-4 py-1.5 bg-white/20 backdrop-blur-md rounded-full text-sm font-semibold border border-white/30">
                                    {{ school.get_school_type_display }}
                                </span>
                                <span class="px-4 py-1.5 bg-white/20 backdrop-blur-md rounded-full text-sm font-semibold border border-white/30">
                                    {{ school.get_shift_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="text-white text-right bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/20">
                        <p class="text-purple-200 text-sm font-medium mb-1">Organization</p>
                        <p class="text-xl font-bold mb-1">{{ school.organization.name }}</p>
                        <p class="text-purple-200 text-sm font-mono">{{ school.school_code }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modern Statistics Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <!-- Students Card -->
            <div class="stat-card rounded-2xl p-6 shadow-xl cursor-pointer"
                 style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-4">
                        <div class="bg-white/20 backdrop-blur-sm rounded-xl p-3">
                            <i class="fas fa-user-graduate text-3xl text-white"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-white/80 text-xs uppercase tracking-wider font-bold">Total</p>
                            <p class="text-white text-sm font-semibold">Students</p>
                        </div>
                    </div>
                    <h3 class="text-5xl font-black text-white mb-1">{{ total_students }}</h3>
                    <p class="text-white/70 text-sm">out of {{ school.total_capacity }} capacity</p>
                </div>
            </div>

            <!-- Teachers Card -->
            <div class="stat-card rounded-2xl p-6 shadow-xl cursor-pointer"
                 style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-4">
                        <div class="bg-white/20 backdrop-blur-sm rounded-xl p-3">
                            <i class="fas fa-chalkboard-teacher text-3xl text-white"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-white/80 text-xs uppercase tracking-wider font-bold">Total</p>
                            <p class="text-white text-sm font-semibold">Teachers</p>
                        </div>
                    </div>
                    <h3 class="text-5xl font-black text-white mb-1">{{ total_teachers }}</h3>
                    <p class="text-white/70 text-sm">faculty members</p>
                </div>
            </div>

            <!-- Available Seats Card -->
            <div class="stat-card rounded-2xl p-6 shadow-xl cursor-pointer"
                 style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-4">
                        <div class="bg-white/20 backdrop-blur-sm rounded-xl p-3">
                            <i class="fas fa-chair text-3xl text-white"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-white/80 text-xs uppercase tracking-wider font-bold">Available</p>
                            <p class="text-white text-sm font-semibold">Seats</p>
                        </div>
                    </div>
                    <h3 class="text-5xl font-black text-white mb-1">{{ available_capacity }}</h3>
                    <p class="text-white/70 text-sm">{{ enrollment_percentage }}% capacity filled</p>
                </div>
            </div>

            <!-- Enrollment Card -->
            <div class="stat-card rounded-2xl p-6 shadow-xl cursor-pointer"
                 style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-4">
                        <div class="bg-white/20 backdrop-blur-sm rounded-xl p-3">
                            <i class="fas fa-chart-pie text-3xl text-white"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-white/80 text-xs uppercase tracking-wider font-bold">Current</p>
                            <p class="text-white text-sm font-semibold">Enrollment</p>
                        </div>
                    </div>
                    <h3 class="text-5xl font-black text-white mb-1">{{ enrollment_percentage }}%</h3>
                    <p class="text-white/70 text-sm">enrollment rate</p>
                </div>
            </div>
        </div>

        <!-- Information Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10">
            
            <!-- School Details -->
            <div class="info-card rounded-3xl shadow-lg p-8 border-l-4 border-indigo-500">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-3 shadow-md">
                        <i class="fas fa-info-circle text-2xl text-white"></i>
                    </div>
                    <h2 class="text-2xl font-black text-gray-800">School Details</h2>
                </div>
                <div class="space-y-5">
                    <div class="flex gap-4 p-4 bg-gradient-to-r from-indigo-50 to-transparent rounded-xl border-l-4 border-indigo-400">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-envelope text-indigo-600"></i>
                            </div>
                        </div>
                        <div class="flex-grow">
                            <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold mb-1">Email Address</p>
                            <p class="text-gray-900 font-semibold">{{ school.email }}</p>
                        </div>
                    </div>
                    <div class="flex gap-4 p-4 bg-gradient-to-r from-cyan-50 to-transparent rounded-xl border-l-4 border-cyan-400">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-phone text-cyan-600"></i>
                            </div>
                        </div>
                        <div class="flex-grow">
                            <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold mb-1">Phone Number</p>
                            <p class="text-gray-900 font-semibold">{{ school.phone }}</p>
                        </div>
                    </div>
                    <div class="flex gap-4 p-4 bg-gradient-to-r from-pink-50 to-transparent rounded-xl border-l-4 border-pink-400">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-map-marker-alt text-pink-600"></i>
                            </div>
                        </div>
                        <div class="flex-grow">
                            <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold mb-1">Location</p>
                            <p class="text-gray-900 font-medium">{{ school.address }}</p>
                            <p class="text-gray-600 text-sm mt-1">{{ school.city }}{% if school.postal_code %}, {{ school.postal_code }}{% endif %}</p>
                        </div>
                    </div>
                    <div class="flex gap-4 p-4 bg-gradient-to-r from-amber-50 to-transparent rounded-xl border-l-4 border-amber-400">
                        <div class="flex-shrink-0">
                            <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-user-tie text-amber-600"></i>
                            </div>
                        </div>
                        <div class="flex-grow">
                            <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold mb-1">Principal</p>
                            <p class="text-gray-900 font-bold">{{ school.principal_name }}</p>
                            <p class="text-gray-600 text-xs mt-1">{{ school.principal_email }}</p>
                            <p class="text-gray-600 text-xs">{{ school.principal_phone }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Configuration -->
            <div class="info-card rounded-3xl shadow-lg p-8 border-l-4 border-emerald-500">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-3 shadow-md">
                            <i class="fas fa-calendar-alt text-2xl text-white"></i>
                        </div>
                        <h2 class="text-2xl font-black text-gray-800">Academic Setup</h2>
                    </div>
                    {% if user.is_superuser %}
                    <a href="{% url 'schools:academic_config_update' school.pk %}" 
                       class="text-emerald-600 hover:text-emerald-700 font-semibold px-4 py-2 rounded-xl bg-emerald-50 hover:bg-emerald-100 transition">
                        <i class="fas fa-edit mr-1"></i> Edit
                    </a>
                    {% endif %}
                </div>
                {% if academic_config %}
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-slate-50 to-transparent rounded-lg border-b-2 border-slate-200">
                        <span class="text-gray-600 font-medium text-sm">Academic Year</span>
                        <span class="text-gray-900 font-bold">{{ academic_config.current_academic_year }}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-slate-50 to-transparent rounded-lg border-b-2 border-slate-200">
                        <span class="text-gray-600 font-medium text-sm">Number of Terms</span>
                        <span class="text-gray-900 font-bold">{{ academic_config.number_of_terms }}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-slate-50 to-transparent rounded-lg border-b-2 border-slate-200">
                        <span class="text-gray-600 font-medium text-sm">Grading System</span>
                        <span class="text-gray-900 font-bold">{{ academic_config.get_grading_system_display }}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-slate-50 to-transparent rounded-lg border-b-2 border-slate-200">
                        <span class="text-gray-600 font-medium text-sm">Passing Marks</span>
                        <span class="text-gray-900 font-bold">{{ academic_config.passing_marks }}%</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-slate-50 to-transparent rounded-lg border-b-2 border-slate-200">
                        <span class="text-gray-600 font-medium text-sm">Class Timing</span>
                        <span class="text-gray-900 font-bold">
                            {{ academic_config.class_start_time|time:"H:i" }} - {{ academic_config.class_end_time|time:"H:i" }}
                        </span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-slate-50 to-transparent rounded-lg border-b-2 border-slate-200">
                        <span class="text-gray-600 font-medium text-sm">Min. Attendance</span>
                        <span class="text-gray-900 font-bold">{{ academic_config.minimum_attendance_percentage }}%</span>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-12">
                    <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-circle text-4xl text-emerald-600"></i>
                    </div>
                    <p class="text-gray-600 mb-6 font-medium">Academic configuration not set</p>
                    {% if user.is_superuser %}
                    <a href="{% url 'schools:academic_config_update' school.pk %}" 
                       class="inline-block bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-bold px-6 py-3 rounded-xl shadow-lg transition">
                        Configure Now
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="info-card rounded-3xl shadow-lg p-8 mb-10">
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-gradient-to-br from-violet-500 to-fuchsia-600 rounded-2xl p-3 shadow-md">
                    <i class="fas fa-bolt text-2xl text-white"></i>
                </div>
                <h2 class="text-2xl font-black text-gray-800">Quick Actions</h2>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <a href="#" 
                   class="action-btn group relative bg-gradient-to-br from-pink-500 to-rose-600 hover:from-pink-600 hover:to-rose-700 rounded-2xl p-6 text-center text-white shadow-lg transform transition-all opacity-60 cursor-not-allowed">
                    <div class="relative z-10">
                        <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-user-graduate text-3xl"></i>
                        </div>
                        <p class="font-bold text-lg">Students</p>
                        <p class="text-white/80 text-sm mt-1">Coming Soon</p>
                    </div>
                </a>
                <a href="#" 
                   class="action-btn group relative bg-gradient-to-br from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 rounded-2xl p-6 text-center text-white shadow-lg transform transition-all opacity-60 cursor-not-allowed">
                    <div class="relative z-10">
                        <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-chalkboard-teacher text-3xl"></i>
                        </div>
                        <p class="font-bold text-lg">Teachers</p>
                        <p class="text-white/80 text-sm mt-1">Coming Soon</p>
                    </div>
                </a>
                {% if user.is_superuser %}
                <a href="{% url 'schools:academic_config_update' school.pk %}" 
                   class="action-btn group relative bg-gradient-to-br from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 rounded-2xl p-6 text-center text-white shadow-lg transform transition-all">
                    <div class="relative z-10">
                        <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-cog text-3xl"></i>
                        </div>
                        <p class="font-bold text-lg">Configuration</p>
                        <p class="text-white/80 text-sm mt-1">Academic Settings</p>
                    </div>
                </a>
                <a href="{% url 'schools:branding_update' school.pk %}" 
                   class="action-btn group relative bg-gradient-to-br from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 rounded-2xl p-6 text-center text-white shadow-lg transform transition-all">
                    <div class="relative z-10">
                        <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-palette text-3xl"></i>
                        </div>
                        <p class="font-bold text-lg">Branding</p>
                        <p class="text-white/80 text-sm mt-1">School Identity</p>
                    </div>
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Switch School -->
        <div class="relative overflow-hidden rounded-3xl shadow-xl"
             style="background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);">
            <div class="absolute inset-0 opacity-5">
                <div class="absolute inset-0" style="background-image: radial-gradient(circle, #ffffff 1px, transparent 1px); background-size: 20px 20px;"></div>
            </div>
            <div class="relative p-6 flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-center sm:text-left">
                    <p class="text-white font-bold text-lg mb-1 flex items-center gap-2">
                        <i class="fas fa-random"></i>
                        Switch School
                    </p>
                    <p class="text-gray-300 text-sm">Access different school data and management tools</p>
                </div>
                <a href="{% url 'schools:school_list' %}" 
                   class="action-btn bg-white hover:bg-gray-100 text-gray-900 font-bold px-8 py-4 rounded-2xl inline-flex items-center gap-3 shadow-lg transition-all">
                    <i class="fas fa-exchange-alt text-lg"></i>
                    <span>Change School</span>
                </a>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}
